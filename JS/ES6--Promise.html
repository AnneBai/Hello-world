<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>try something</title>
  </head>
  <body>
    <script>
//getJson Ajax 实例
      // const getJson = function (url) {
      //   const promise = new Promise(function(resolve, reject){
      //     const handler = function () {
      //       if (this.readyState !== 4) {
      //         return;
      //       }
      //       if (this.status === 200) {
      //         resolve(this.responseText);
      //       } else {
      //         reject(new Error(this.statusText));
      //       }
      //     }
      //     const XHR = new XMLHttpRequest();
      //     XHR.open("GET", url, true);
      //     XHR.responseType = "json";
      //     XHR.onreadystatechange = handler;
      //     XHR.setRequestHeader("Accept", "application/json");
      //     XHR.send()
      //   });
      //   return promise;
      // }
      // getJson("file:///E:/learnES6/posts.json").then(function(json){
      //   console.log("Contents: "+json);
      // }, function (error) {
      //   console.error("Error: ", error);
      // });

    // console.log("start");
    // let p = new Promise(function (resolve, reject) {
    //   resolve("OK-1"); //立即执行then中成功状态回调函数
    //   setTimeout(function () {
    //     console.log("1");
    //   }, 0);
    // })
    //   .then(function (value) {
    //     console.log("2 " + value);
    //     setTimeout(function () {
    //       console.log("3");
    //     }, 0);
    //     return new Promise(function (resolve, reject) {
    //       setTimeout(function () {
    //         resolve("OK-2")
    //       }, 2000);
    //     })
    //   })
    //   .then(function (value) {
    //     //等待上一个then返回的Promise对象改变状态之后执行；
    //     console.log("4 " + value);
    //     setTimeout(function () {
    //       console.log("5");
    //     }, 0);
    //   });
    //   // start --> "2 OK-1" --> "1" --> "3" --> "4 OK-2" --> "5"

    // console.log("start");
    // let p = new Promise(function (resolve, reject) {
    //   resolve("OK-1"); //立即执行then中成功状态回调函数
    //   setTimeout(function () {
    //     console.log("1");
    //   }, 0);
    // })
    //   .then(function () {
    //     console.log("2");
    //     setTimeout(function () {
    //       console.log("3");
    //     }, 0);
    //     return new Promise(function (resolve, reject) {
    //       setTimeout(function () {
    //         console.log("setTimeout");
    //       }, 2000);
    //       resolve();
    //     }).then(function () {
    //       console.log("4");
    //       setTimeout (function () {
    //         console.log("5");
    //       }, 2000)
    //     });
    //   })
    //   .then(function () {
    //     //等待上一个then返回的Promise对象改变状态之后执行；
    //     console.log("6");
    //     setTimeout(function () {
    //       console.log("7");
    //     }, 0);
    //   })
    //   .catch(function (error) {
    //     console.log(error);
    //   });
      //start --> 2 --> 1 --> 3 --> 4 --> 6 --> 7 -->5

      // Promise.resolve("1").then(Promise.resolve("2")).then(Promise.resolve("3"))
      // .then(function (value) {
      //   console.log(value);  // 1
      // });
// then需要接收函数作为参数，且最好使用return返回值或另一个函数
      // function test(value) {
      //   console.log(value);
      // }
      // let p = new Promise(function (resolve) {
      //   console.log("0");
      //   setTimeout (function(){
      //     console.log("1");
      //   }, 0);
      //   resolve("2");        
      // })
      // p.then(function (value) {
      //   console.log("then1");
      //   return test(value);
      // })
      // .then(test)
      // .catch(function (error) {
      //   console.log("the error is "+ error);
      // });
      // then1 --> 2 --> undefined --> 1

      // console.log(0)
      // var a = new Promise(function (res, rej) {
      //   console.log('1')
      //   setTimeout(() => console.log('4'))
      //   res(3)
      // })
      // a.then(function (val) {
      //   console.log(val)
      // })
      // console.log(2)

      console.log(0)
      var a = new Promise(function (res, rej) {
        console.log('1')
        setTimeout(() => console.log('4'))
        res(3)
      })
      a.then(v => loop(a))
      function loop (p) {
        var i = 0
        while (i++ < 5)
        p.then(v => console.log(v))
      }
      console.log(2)
    </script>
  </body>
</html>